healthcheck_endpoint: /SYSTEM/dbtest
service_name: app
ldap_access_group_suffix: webserver

pod:
  containers:
    app:
      image_name: "{{ aws_ecr_registry }}/app"
      image_tag: "{{ lookup('aws_ssm', '/<<.Env>>/app/image_tag') }}"

      # This config is utilized in role deploy-c14n-prod/tasks/services.yml
      #nofile: "nofile:1024:8192"
      nofile: "nofile:1024:1024"

      log_driver: json-file

      environment:
        CONFD_BACKEND: env
        COOKIE_DOMAIN: .<<.TldDomain>>
        DB_HOST: db.priv.<<.BaseDomain>>
        DB_NAME: <<.DbName>>
        DB_PASSWORD: "{{ lookup('aws_ssm', '/<<.Env>>/db/password/app_web') }}"
        DEPLOYMENT_INFRASTRUCTURE: <<.DeploymentInfrastructure>>
        EMAIL_DEFAULT_DOMAIN: <<.BaseDomain>>
        EMAIL_ERROR_DOMAIN: <<.BaseDomain>>
        EMAIL_SENDER: proxy-mailer@<<.BaseDomain>>
        MARKETINGSITE: https://<<.MarketingSite>>
        MARKETINGSITEPATHPREFIX: <<.MarketingSitePathPrefix>>
        WASCONFIGVERSION: "{{ lookup('aws_ssm', '/<<.Env>>/app/wasconfigversion') }}"
        EMAIL_ERROR_ALTERNATE: <<.FeedbackEmail>>
        EMAIL_NOTIFICATION_SENDER: do-not-reply@<<.BaseDomain>>
        EMAIL_RCPT_DOMAINS_ALLOWED: "<<.EmailRcptDomainsAllowed>>"
        EMAIL_SUBJECT_PREPEND: "<<.EmailSubjectPrepend>>"
        EXECUTABLES_SENDMAIL: /usr/sbin/sendmail -C/arena/app/conf/ssmtp.conf -t
        APPLICATION_MONITORING_EMAIL: <<.ApplicationMonitoringEmail>>
        EXTERNAL_ADMIN_HOST: admin.<<.BaseDomain>>
        EXTERNAL_API_HOST: api.<<.BaseDomain>>
        EXTERNAL_APP_HOST: app.<<.BaseDomain>>
        EXTERNAL_APPS_HOST: apps.<<.BaseDomain>>
        EXTERNAL_AUTH_HOST: auth.<<.BaseDomain>>
        EXTERNAL_FILES_HOST: files.<<.BaseDomain>>
        FEEDBACK_CHECKIFPRODUCTION: "<<.CheckIfProduction>>"
        FEEDBACK_TICKETDEFAULTEMAIL: <<.FeedbackEmail>>
        HTTP_HEADERS_SOURCEIP: "<<.HttpHeadersSourceIp>>"
        NETWORK_LOCALCIDR: 0.0.0.0/0
        PKI_CLIENTCOMMONNAME: priv.<<.BaseDomain>>
        PKI_PASSWORD: "{{ lookup('aws_ssm', '/pki/password/<<.Env>>') }}"
        REDIRECT_DOMAINS: <<.TldDomain>>
        REDIS_HOST: redis.priv.<<.BaseDomain>>
        SALESFORCE_LEAD_URL: <<.SalesforceLeadURL>>
        SALESFORCE_ARENA_ORG_ID: <<.SalesforceArenaOrgId>>
        SALESFORCE_CUSTOMERPORTAL_LOGIN_URL: <<.SalesforceCustomerPortalLoginUrl>>
        SALESFORCE_LOGIN_ID: <<.SalesforceLoginId>>
        SALESFORCE_LOGIN_PASSWORD: <<.SalesforceLoginPassword>>
        SALESFORCE_WEBTOCASEORIGIN: <<.SalesForceWebToCaseOrigin>>
        SALESFORCE_WEBTOCASEURL: <<.SalesForceWebToCaseUrl>>
        SERVICE_ADMIN_HOST: admin.priv.<<.BaseDomain>>
        SERVICE_API_HOST: api.priv.<<.BaseDomain>>
        SERVICE_APP_HOST: app.priv.<<.BaseDomain>>
        SERVICE_AUTH_HOST: auth.priv.<<.BaseDomain>>
        SERVICE_BLISS_HOST: bliss.priv.<<.BaseDomain>>
        SERVICE_BMS_HOST: bms.priv.<<.BaseDomain>>
        SERVICE_EOS_HOST: eos.priv.<<.BaseDomain>>
        SERVICE_GATE_HOST: gate.priv.<<.BaseDomain>>
        SERVICE_NOTIFY_HOST: notify.priv.<<.BaseDomain>>
        SERVICE_PLM_HOST: plm.priv.<<.BaseDomain>>
        SERVICE_PUBMARKET_HOST: pubmarket.priv.<<.BaseDomain>>
        SERVICE_SCHEDULER_HOST: scheduler.priv.<<.BaseDomain>>
        SERVICE_SDS_HOST: sds.priv.<<.BaseDomain>>
        SERVICE_WORKFLOW_HOST: workflow.priv.<<.BaseDomain>>
        SERVICE_TREX_HOST: trex.priv.<<.BaseDomain>>
        SSMTP_MAILHUB: mail.priv.<<.BaseDomain>>
        LANGUAGE_SETTING: "<<.EnableLanguageSetting>>"
        GOODDATA_HOST: <<.GoodDataHost>>
      ports:
        - 80:8080
        - 8444:8444
      volumes:
        - /arena/pki:/arena/pki
        - /arena/log:/arena/log
      probes:
        - curl -s -f --show-error "http://localhost:80{{ healthcheck_endpoint }}"
